<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>French Flashcards</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #0b1120;
      --panel: #0f172a;
      --accent: #22c55e;
      --accent-2: #38bdf8;
      --text: #e2e8f0;
      --muted: #94a3b8;
      --border: #1f2937;
      --card: linear-gradient(145deg, #111827, #0f172a);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Poppins', system-ui, sans-serif;
      background: radial-gradient(circle at 15% 20%, rgba(34,197,94,0.10), transparent 30%),
                  radial-gradient(circle at 85% 0%, rgba(56,189,248,0.12), transparent 30%),
                  var(--bg);
      color: var(--text);
      min-height: 100vh;
    }
    header {
      padding: 24px 28px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      border-bottom: 1px solid var(--border);
      background: rgba(15,23,42,0.8);
      position: sticky;
      top: 0;
      backdrop-filter: blur(8px);
      z-index: 2;
    }
    header a { color: var(--muted); text-decoration: none; font-weight: 600; }
    header a:hover { color: var(--text); }
    main { max-width: 1200px; margin: 0 auto; padding: 28px; }
    h1 { margin: 0 0 6px; letter-spacing: -0.02em; }
    .controls {
      display: grid;
      gap: 12px;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      margin: 20px 0 28px;
    }
    .control {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px 14px;
    }
    label { display: block; font-size: 13px; color: var(--muted); margin-bottom: 6px; }
    select, button.primary {
      width: 100%;
      border-radius: 8px;
      border: 1px solid var(--border);
      padding: 10px 12px;
      background: #0b1224;
      color: var(--text);
      font-weight: 600;
      cursor: pointer;
    }
    button.primary { background: linear-gradient(135deg, #22c55e, #16a34a); border: none; color: #f8fafc; }
    button.primary:disabled { opacity: 0.5; cursor: not-allowed; }
    .board {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 18px;
    }
    @media (max-width: 960px) { .board { grid-template-columns: 1fr; } }
    .card-shell {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      position: relative;
      min-height: 420px;
    }
    .card {
      background: var(--card);
      border-radius: 14px;
      padding: 20px 20px 16px;
      border: 1px solid var(--border);
      box-shadow: 0 16px 40px rgba(0,0,0,0.35);
      min-height: 300px;
      position: relative;
      overflow: hidden;
    }
    .card .face-label { font-size: 12px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; }
    .prompt { font-size: 40px; margin: 12px 0 8px; }
    .tagline { color: var(--muted); margin: 0 0 12px; }
    .back {
      margin-top: 12px;
      background: rgba(15,23,42,0.6);
      border: 1px dashed var(--border);
      border-radius: 12px;
      padding: 14px;
    }
    .detail-grid { display: grid; gap: 10px; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); }
    .reveal-block { perspective: 1200px; }
    .reveal-block .flip-inner {
      position: relative;
      background: #0b1120;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px 12px;
      cursor: pointer;
      overflow: hidden;
      transform-style: preserve-3d;
      transition: transform 0.65s ease;
      min-height: 110px;
      box-shadow: 0 12px 26px rgba(0,0,0,0.25);
    }
    .reveal-block.revealed .flip-inner { transform: rotateY(180deg); }
    .reveal-block .face {
      position: absolute;
      inset: 0;
      display: grid;
      align-content: space-between;
      backface-visibility: hidden;
      gap: 8px;
    }
    .reveal-block .face .label { font-size: 12px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.06em; }
    .reveal-block .face .value { font-size: 18px; font-weight: 600; margin-top: 4px; }
    .reveal-block .face.front { justify-items: start; }
    .reveal-block .face.front .value { color: rgba(226,232,240,0.55); }
    .reveal-block .face.front .pill-hint { padding: 6px 10px; background: rgba(59,130,246,0.1); border: 1px dashed rgba(59,130,246,0.35); border-radius: 20px; color: #bfdbfe; font-weight: 600; font-size: 13px; justify-self: flex-start; }
    .reveal-block .face.back { transform: rotateY(180deg); }
    .reveal-block button.sound { justify-self: flex-end; background: rgba(255,255,255,0.08); border: 1px solid var(--border); color: var(--text); border-radius: 8px; padding: 6px 8px; cursor: pointer; }
    .reveal-block.highlight .flip-inner { border-color: rgba(56,189,248,0.6); box-shadow: 0 12px 30px rgba(56,189,248,0.18); }
    .reveal-block.highlight .face.front { color: #bae6fd; }
    .actions { display: flex; gap: 12px; margin: 16px 0 6px; flex-wrap: wrap; }
    .secondary { background: transparent; color: var(--text); border: 1px solid var(--border); border-radius: 10px; padding: 10px 14px; cursor: pointer; }
    .grades { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; }
    .grade-btn { border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: 700; color: #0b1120; }
    .grade-again { background: #f87171; }
    .grade-hard { background: #fbbf24; }
    .grade-medium { background: #34d399; }
    .grade-easy { background: #60a5fa; }
    .grade-good { background: #a78bfa; }
    .meta { color: var(--muted); margin-top: 8px; font-size: 14px; }
    .pill { display: inline-flex; align-items: center; gap: 8px; padding: 8px 10px; background: rgba(34,197,94,0.12); border-radius: 10px; border: 1px solid rgba(34,197,94,0.3); color: var(--text); font-weight: 600; }
    .deck-info { background: var(--panel); border: 1px solid var(--border); border-radius: 16px; padding: 18px; }
    .stat { display: flex; justify-content: space-between; margin-bottom: 8px; color: var(--muted); }
    .stat strong { color: var(--text); }
    .hidden { display: none; }
  </style>
</head>
<body>
  <header>
    <div>
      <div style="font-weight:700;">French Flashcards</div>
      <small style="color: var(--muted);">IPA, audio, and spaced repetition</small>
    </div>
    <a href="./index.html">‚Üê Back to menu</a>
  </header>
  <main>
    <h1>Choose your session</h1>
    <div class="controls">
      <div class="control">
        <label for="styleSelect">Card style</label>
        <select id="styleSelect">
          <option value="fr-en">French ‚Üí English</option>
          <option value="en-fr">English ‚Üí French</option>
        </select>
      </div>
      <div class="control">
        <label for="deckSelect">Deck (50 cards each)</label>
        <select id="deckSelect"></select>
      </div>
      <div class="control">
        <label>Session</label>
        <button id="startSession" class="primary">Start session</button>
      </div>
    </div>

    <div class="board">
      <div class="card-shell">
        <div class="card" id="card">
          <div class="face-label">Prompt</div>
          <div class="prompt" id="prompt">Select a deck to begin</div>
          <p class="tagline" id="tagline"></p>
          <div class="back hidden" id="back">
            <div class="face-label">Answer</div>
            <div class="detail-grid" id="detailGrid"></div>
            <div class="actions">
              <button class="secondary" id="revealAll">Show all</button>
              <button class="secondary" id="speakBtn">üîä Hear it</button>
            </div>
          </div>
        </div>
        <div class="grades hidden" id="gradeRow">
          <button class="grade-btn grade-again" data-offset="2" data-action="again">Again</button>
          <button class="grade-btn grade-hard" data-offset="5" data-action="hard">Hard</button>
          <button class="grade-btn grade-medium" data-offset="10" data-action="medium">Medium</button>
          <button class="grade-btn grade-easy" data-offset="15" data-action="easy">Easy</button>
          <button class="grade-btn grade-good" data-offset="remove" data-action="good">Good</button>
        </div>
        <div class="meta" id="queueInfo"></div>
      </div>
      <div class="deck-info">
        <div class="stat"><span>Deck size</span><strong id="deckSize">0</strong></div>
        <div class="stat"><span>Remaining</span><strong id="remaining">0</strong></div>
        <div class="stat"><span>Current rank</span><strong id="rank">-</strong></div>
        <div class="stat"><span>Style</span><strong id="styleLabel">-</strong></div>
      </div>
    </div>
  </main>

  <script>
    const wordlistUrl = '../French/wordlist.json';
    const pronUrl = '../French/pronuncations.json';

    let cards = [];
    let queue = [];
    let currentCard = null;
    let currentStyle = 'fr-en';

    const promptEl = document.getElementById('prompt');
    const taglineEl = document.getElementById('tagline');
    const backEl = document.getElementById('back');
    const detailGrid = document.getElementById('detailGrid');
    const gradeRow = document.getElementById('gradeRow');
    const queueInfo = document.getElementById('queueInfo');
    const deckSizeEl = document.getElementById('deckSize');
    const remainingEl = document.getElementById('remaining');
    const rankEl = document.getElementById('rank');
    const styleLabel = document.getElementById('styleLabel');
    const speakBtn = document.getElementById('speakBtn');

    async function loadData() {
      const [words, prons] = await Promise.all([
        fetch(wordlistUrl).then(r => r.json()),
        fetch(pronUrl).then(r => r.json())
      ]);
      const pronMap = new Map(prons.map(p => [p.rank, p]));
      cards = words
        .map(entry => ({ ...entry, pronunciation: pronMap.get(entry.rank) || null }))
        .sort((a, b) => a.rank - b.rank);
      populateDecks(cards.length);
    }

    function populateDecks(total) {
      const deckSelect = document.getElementById('deckSelect');
      deckSelect.innerHTML = '';
      const deckCount = Math.ceil(total / 50);
      for (let i = 0; i < deckCount; i++) {
        const start = i * 50 + 1;
        const end = Math.min(total, (i + 1) * 50);
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = `Deck ${i + 1} (ranks ${start}-${end})`;
        deckSelect.appendChild(opt);
      }
    }

    function startSession() {
      const deckIndex = parseInt(document.getElementById('deckSelect').value, 10) || 0;
      currentStyle = document.getElementById('styleSelect').value;
      const start = deckIndex * 50;
      const slice = cards.slice(start, start + 50);
      queue = [...slice];
      currentCard = null;
      deckSizeEl.textContent = queue.length;
      styleLabel.textContent = currentStyle === 'fr-en' ? 'French ‚Üí English' : 'English ‚Üí French';
      nextCard();
    }

    function nextCard() {
      if (queue.length === 0) {
        promptEl.textContent = 'Deck completed!';
        taglineEl.textContent = 'Start a new session to keep going.';
        backEl.classList.add('hidden');
        gradeRow.classList.add('hidden');
        rankEl.textContent = '-';
        remainingEl.textContent = '0';
        return;
      }
      currentCard = queue[0];
      renderCard(currentCard);
    }

    function renderCard(card) {
      const isFrenchPrompt = currentStyle === 'fr-en';
      promptEl.textContent = isFrenchPrompt ? card.word : (card.meaning_en || card.word);
      taglineEl.textContent = isFrenchPrompt ? 'What does this mean in English?' : 'How do you say this in French?';
      backEl.classList.remove('hidden');
      gradeRow.classList.remove('hidden');
      buildDetailBlocks(card);
      updateMeta();
    }

    function updateMeta() {
      remainingEl.textContent = queue.length;
      rankEl.textContent = currentCard ? currentCard.rank : '-';
      queueInfo.textContent = queue.length ? `${queue.length} card(s) left in this session.` : '';
    }

    function buildDetailBlocks(card) {
      const isFrenchPrompt = currentStyle === 'fr-en';
      const blocks = [];

      if (isFrenchPrompt) {
        blocks.push(createBlock('Meaning', card.meaning_en || '‚Äî', true));
        blocks.push(createPronBlock(card));
        blocks.push(createBlock('Gender', card.gender || '‚Äî'));
        blocks.push(createBlock('Part of speech', card.pos || '‚Äî'));
      } else {
        blocks.push(createBlock('French word', card.word, true));
        blocks.push(createPronBlock(card));
        blocks.push(createBlock('Gender', card.gender || '‚Äî'));
        blocks.push(createBlock('Part of speech', card.pos || '‚Äî'));
      }
      detailGrid.innerHTML = '';
      blocks.forEach(b => detailGrid.appendChild(b));
    }

    function revealTile(tile) {
      tile.classList.add('revealed');
      tile.classList.remove('masked');
    }

    function createBlock(label, value, highlightMeaning = false) {
      const div = document.createElement('div');
      div.className = 'reveal-block masked' + (highlightMeaning ? ' highlight' : '');
      div.tabIndex = 0;

      const inner = document.createElement('div');
      inner.className = 'flip-inner';

      const front = document.createElement('div');
      front.className = 'face front';
      const frontLabel = document.createElement('div');
      frontLabel.className = 'label';
      frontLabel.textContent = label;
      const frontValue = document.createElement('div');
      frontValue.className = 'value';
      frontValue.textContent = 'Tap to reveal';
      const hint = document.createElement('div');
      hint.className = 'pill-hint';
      hint.textContent = 'Spin to see';
      front.append(frontLabel, frontValue, hint);

      const back = document.createElement('div');
      back.className = 'face back';
      const backLabel = document.createElement('div');
      backLabel.className = 'label';
      backLabel.textContent = label;
      const backValue = document.createElement('div');
      backValue.className = 'value';
      backValue.textContent = value;
      back.append(backLabel, backValue);

      inner.append(front, back);
      div.append(inner);

      div.addEventListener('click', () => revealTile(div));
      div.addEventListener('keypress', (e) => { if (e.key === 'Enter') revealTile(div); });
      return div;
    }

    function createPronBlock(card) {
      const pron = card.pronunciation;
      const container = document.createElement('div');
      container.className = 'reveal-block masked';
      container.tabIndex = 0;

      const inner = document.createElement('div');
      inner.className = 'flip-inner';

      const front = document.createElement('div');
      front.className = 'face front';
      const frontLabel = document.createElement('div');
      frontLabel.className = 'label';
      frontLabel.textContent = 'Pronunciation';
      const frontValue = document.createElement('div');
      frontValue.className = 'value';
      frontValue.textContent = 'Tap to reveal';
      const hint = document.createElement('div');
      hint.className = 'pill-hint';
      hint.textContent = 'Spin to see';
      front.append(frontLabel, frontValue, hint);

      const back = document.createElement('div');
      back.className = 'face back';
      const label = document.createElement('div');
      label.className = 'label';
      label.textContent = 'Pronunciation';
      const value = document.createElement('div');
      value.className = 'value';
      value.innerHTML = pron ? `${pron.phonetic} ¬∑ ${pron.ipa}` : '‚Äî';
      const btn = document.createElement('button');
      btn.className = 'sound';
      btn.type = 'button';
      btn.textContent = 'üîä';
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        speak(card.word);
      });
      back.append(label, value, btn);

      inner.append(front, back);
      container.append(inner);

      container.addEventListener('click', () => revealTile(container));
      container.addEventListener('keypress', (e) => { if (e.key === 'Enter') revealTile(container); });
      return container;
    }

    function gradeCard(action, offset) {
      if (!currentCard) return;
      queue.shift();
      if (offset !== 'remove') {
        const position = Math.min(queue.length, offset);
        queue.splice(position, 0, currentCard);
      }
      currentCard = null;
      nextCard();
    }

    function speak(word) {
      if (!('speechSynthesis' in window)) return;
      const utter = new SpeechSynthesisUtterance(word);
      utter.lang = 'fr-FR';
      utter.rate = 0.95;
      window.speechSynthesis.speak(utter);
    }

    document.getElementById('startSession').addEventListener('click', startSession);
    document.getElementById('revealAll').addEventListener('click', () => {
      detailGrid.querySelectorAll('.reveal-block.masked').forEach(el => revealTile(el));
    });
    speakBtn.addEventListener('click', () => currentCard && speak(currentCard.word));
    gradeRow.addEventListener('click', (e) => {
      const btn = e.target.closest('.grade-btn');
      if (!btn) return;
      const offset = btn.dataset.offset === 'remove' ? 'remove' : parseInt(btn.dataset.offset, 10);
      gradeCard(btn.dataset.action, offset);
    });

    loadData();
  </script>
</body>
</html>
