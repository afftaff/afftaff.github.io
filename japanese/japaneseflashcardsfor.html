<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Japanese Flashcards (URL Deck)</title>
  <style>
    :root {
      color-scheme: light dark;
      --bg: #f6f6f9;
      --card: #ffffff;
      --text: #1d1d1f;
      --accent: #4b5cff;
      --muted: #7a7f8c;
      --border: #d9dce6;
      --back: #f1f3ff;
      font-family: "Noto Sans JP", system-ui, -apple-system, sans-serif;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      padding: 24px;
    }

    header {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 20px;
    }

    h1 {
      margin: 0;
      font-size: 1.8rem;
    }

    .instructions {
      font-size: 0.95rem;
      color: var(--muted);
    }

    .deck {
      display: grid;
      gap: 16px;
    }

    .card-stage {
      display: grid;
      gap: 12px;
      align-items: center;
      justify-items: center;
    }

    .flashcard {
      width: min(520px, 90vw);
      height: 280px;
      perspective: 1000px;
      cursor: pointer;
    }

    .flashcard-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
      transition: transform 0.6s;
    }

    .flashcard.is-flipped .flashcard-inner {
      transform: rotateY(180deg);
    }

    .flashcard-face {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 18px;
      border: 2px solid var(--border);
      background: var(--card);
      box-shadow: 0 16px 30px rgba(0, 0, 0, 0.08);
      backface-visibility: hidden;
      padding: 20px;
      text-align: center;
    }

    .flashcard-back {
      background: var(--back);
      transform: rotateY(180deg);
      flex-direction: column;
      gap: 14px;
    }

    .kana {
      font-size: 3rem;
      letter-spacing: 2px;
    }

    .reveal-block {
      padding: 12px 18px;
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.7);
      border: 1px dashed var(--border);
      min-width: 200px;
    }

    .reveal-label {
      display: block;
      font-size: 0.85rem;
      color: var(--muted);
      margin-bottom: 6px;
    }

    .reveal-value {
      font-size: 1.3rem;
      font-weight: 600;
    }

    .hidden-value {
      color: transparent;
      text-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }

    .reveal-button {
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 6px 14px;
      background: var(--card);
      color: var(--text);
      font-size: 0.85rem;
      cursor: pointer;
      margin-top: 8px;
    }

    .controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .controls button {
      border: none;
      padding: 10px 18px;
      border-radius: 999px;
      font-weight: 600;
      cursor: pointer;
      background: var(--accent);
      color: white;
    }

    .controls button.secondary {
      background: #dfe3ff;
      color: #1f2a8a;
    }

    .meta {
      text-align: center;
      color: var(--muted);
      font-size: 0.9rem;
    }

    .queue {
      margin-top: 18px;
      border-top: 1px dashed var(--border);
      padding-top: 12px;
    }

    .queue h2 {
      margin: 0 0 8px;
      font-size: 1.1rem;
    }

    .queue-list {
      display: grid;
      gap: 6px;
      font-size: 0.9rem;
      color: var(--muted);
    }

    @media (max-width: 600px) {
      .flashcard {
        height: 240px;
      }

      .kana {
        font-size: 2.4rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Japanese Flashcards (URL Deck)</h1>
    <div class="instructions">
      Pass cards via the URL using <code>?card=meaning|romaji|kana</code> (repeat <code>card</code> for multiple entries).
      Click the card to flip. On the back, click each section to reveal meaning + romaji.
    </div>
    <div class="instructions">
      Examples:
      <ul>
        <li><code>?card=thank%20you|arigatou|%E3%81%82%E3%82%8A%E3%81%8C%E3%81%A8%E3%81%86&amp;card=student|gakusei|%E3%81%8C%E3%81%8F%E3%81%9B%E3%81%84</code></li>
        <li><code>?card=water|mizu|%E3%81%BF%E3%81%9A&amp;card=fire|hi|%E3%81%B2&amp;card=tree|ki|%E3%81%8D</code></li>
        <li><code>?card=good%20night|oyasumi|%E3%81%8A%E3%82%84%E3%81%99%E3%81%BF&amp;card=delicious|oishii|%E3%81%8A%E3%81%84%E3%81%97%E3%81%84</code></li>
      </ul>
    </div>
  </header>

  <main class="deck">
    <section class="card-stage">
      <div class="flashcard" id="flashcard" role="button" aria-pressed="false" tabindex="0">
        <div class="flashcard-inner">
          <div class="flashcard-face flashcard-front">
            <div class="kana" id="kana">かな</div>
          </div>
          <div class="flashcard-face flashcard-back">
            <div class="reveal-block" data-reveal="meaning">
              <span class="reveal-label">Meaning</span>
              <span class="reveal-value hidden-value" id="meaning">Meaning</span>
              <button class="reveal-button" type="button">Reveal</button>
            </div>
            <div class="reveal-block" data-reveal="romaji">
              <span class="reveal-label">Romaji</span>
              <span class="reveal-value hidden-value" id="romaji">Romaji</span>
              <button class="reveal-button" type="button">Reveal</button>
            </div>
          </div>
        </div>
      </div>
      <div class="meta" id="progress">Card 1 / 1</div>
      <div class="controls">
        <button type="button" data-rating="hard">Hard</button>
        <button type="button" data-rating="medium" class="secondary">Medium</button>
        <button type="button" data-rating="good">Good</button>
        <button type="button" data-rating="easy" class="secondary">Easy</button>
      </div>
      <div class="meta" id="next-due">Next due: now</div>
    </section>

    <section class="queue">
      <h2>Upcoming cards</h2>
      <div class="queue-list" id="queue-list"></div>
    </section>
  </main>

  <script>
    const flashcard = document.getElementById("flashcard");
    const kanaEl = document.getElementById("kana");
    const meaningEl = document.getElementById("meaning");
    const romajiEl = document.getElementById("romaji");
    const progressEl = document.getElementById("progress");
    const queueList = document.getElementById("queue-list");
    const nextDueEl = document.getElementById("next-due");

    const revealBlocks = Array.from(document.querySelectorAll(".reveal-block"));

    const urlParams = new URLSearchParams(window.location.search);
    const rawCards = urlParams.getAll("card");

    const defaultCards = [
      { meaning: "thank you", romaji: "arigatou", kana: "ありがとう" },
      { meaning: "good morning", romaji: "ohayou", kana: "おはよう" },
      { meaning: "student", romaji: "gakusei", kana: "がくせい" }
    ];

    function parseCard(raw) {
      const [meaning, romaji, kana] = raw.split("|").map((part) => part.trim());
      if (!meaning || !romaji || !kana) {
        return null;
      }
      return { meaning, romaji, kana };
    }

    const cards = rawCards.map(parseCard).filter(Boolean);
    const deck = cards.length ? cards : defaultCards;

    const storageKey = `japanese-flashcards-${deck.map((card) => card.kana).join("-")}`;
    const now = () => Date.now();

    let schedule = deck.map((card, index) => ({
      id: index,
      ...card,
      intervalMinutes: 0,
      dueAt: now(),
      reviews: 0
    }));

    const stored = localStorage.getItem(storageKey);
    if (stored) {
      try {
        const parsed = JSON.parse(stored);
        schedule = schedule.map((card) => parsed.find((storedCard) => storedCard.id === card.id) || card);
      } catch (error) {
        console.warn("Unable to load schedule", error);
      }
    }

    function saveSchedule() {
      localStorage.setItem(storageKey, JSON.stringify(schedule));
    }

    function getNextCard() {
      const sorted = [...schedule].sort((a, b) => a.dueAt - b.dueAt);
      return sorted[0];
    }

    function formatTime(timestamp) {
      const diffMs = timestamp - now();
      if (diffMs <= 0) return "now";
      const minutes = Math.ceil(diffMs / 60000);
      if (minutes < 60) return `${minutes} min`;
      const hours = Math.ceil(minutes / 60);
      return `${hours} hr`;
    }

    function updateQueue() {
      const sorted = [...schedule].sort((a, b) => a.dueAt - b.dueAt);
      queueList.innerHTML = "";
      sorted.forEach((card) => {
        const line = document.createElement("div");
        line.textContent = `${card.kana} — due ${formatTime(card.dueAt)}`;
        queueList.appendChild(line);
      });
    }

    function resetReveals() {
      revealBlocks.forEach((block) => {
        const value = block.querySelector(".reveal-value");
        value.classList.add("hidden-value");
        block.querySelector(".reveal-button").textContent = "Reveal";
      });
    }

    function renderCard(card, index) {
      kanaEl.textContent = card.kana;
      meaningEl.textContent = card.meaning;
      romajiEl.textContent = card.romaji;
      progressEl.textContent = `Card ${index + 1} / ${schedule.length}`;
      nextDueEl.textContent = `Next due: ${formatTime(card.dueAt)}`;
      resetReveals();
    }

    function applyRating(card, rating) {
      const multipliers = {
        hard: 5,
        medium: 20,
        good: 60,
        easy: 240
      };

      const base = multipliers[rating] || 20;
      const newInterval = Math.max(base, Math.round(card.intervalMinutes * 1.7));
      card.intervalMinutes = newInterval;
      card.reviews += 1;
      card.dueAt = now() + newInterval * 60000;
      saveSchedule();
      updateQueue();
      showNext();
    }

    function showNext() {
      const next = getNextCard();
      const index = schedule.findIndex((card) => card.id === next.id);
      renderCard(next, index);
      flashcard.classList.remove("is-flipped");
      flashcard.setAttribute("aria-pressed", "false");
    }

    flashcard.addEventListener("click", () => {
      flashcard.classList.toggle("is-flipped");
      const pressed = flashcard.classList.contains("is-flipped");
      flashcard.setAttribute("aria-pressed", pressed.toString());
    });

    flashcard.addEventListener("keydown", (event) => {
      if (event.key === "Enter" || event.key === " ") {
        event.preventDefault();
        flashcard.click();
      }
    });

    revealBlocks.forEach((block) => {
      const button = block.querySelector(".reveal-button");
      button.addEventListener("click", (event) => {
        event.stopPropagation();
        const value = block.querySelector(".reveal-value");
        const isHidden = value.classList.contains("hidden-value");
        value.classList.toggle("hidden-value", !isHidden);
        button.textContent = isHidden ? "Hide" : "Reveal";
      });
    });

    document.querySelectorAll("[data-rating]").forEach((button) => {
      button.addEventListener("click", () => {
        const rating = button.getAttribute("data-rating");
        const current = getNextCard();
        applyRating(current, rating);
      });
    });

    updateQueue();
    showNext();
  </script>
</body>
</html>
